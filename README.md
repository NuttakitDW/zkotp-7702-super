# zkOTP‑7702‑Super

> **All‑in‑one monorepo for a zero‑knowledge OTP smart‑account guard, powered by EIP‑7702.**
> Clone once, spin up contracts, circuit, and front‑end in minutes.

---

## 🗂 Repository layout (submodules)

| Path                   | Sub‑repository      | Purpose                                                                                          |
| ---------------------- | ------------------- | ------------------------------------------------------------------------------------------------ |
| `contracts/`           | **zkotp-contracts** | Solidity sources (`zkOtpGuard.sol`, autogenerated `Verifier.sol`), Foundry tests, deploy scripts |
| `circuit/`             | **zkotp-circuit**   | Rust guest (RISC‑V), `cargo risczero` build scripts, proving key artefacts                       |
| `apps/frontend/`       | **zkotp-frontend**  | Next.js UI: 7702 upgrade wizard, OTP modal, WASM proof wrapper                                   |
| `apps/api/` (opt.)     | **zkotp-api**       | ElysiaJS service for gas refunds & pointer‑change alerts                                         |
| `packages/sdk/` (opt.) | **zkotp-sdk**       | NPM helper `sendOtpTx()` + TS types for proof & guard ABI                                        |

---

## ⚡ Quick start

```bash
# clone everything, submodules included
$ git clone --recursive https://github.com/yourOrg/zkotp-7702-super.git
$ cd zkotp-7702-super

# install workspace deps & auto‑build circuit WASM
$ pnpm i

# run the front‑end on http://localhost:3000
$ pnpm dev

# run Foundry tests for contracts
$ forge test -C contracts
```

> **Note** : if you forget `--recursive`, run `git submodule update --init --recursive` after cloning.

---

## 🏗 Development scripts

| Command                                                       | What it does                                      |
| ------------------------------------------------------------- | ------------------------------------------------- |
| `cargo risczero build`                                        | Compile OTP guest to RISC‑V ELF & WASM            |
| `cargo risczero prove --input time.json --private secret.bin` | Generate a STARK receipt                          |
| `cargo risczero export-solidity`                              | Autogenerate `Verifier.sol` into `contracts/src/` |
| `forge script script/Deploy.s.sol --broadcast --rpc-url=$RPC` | Deploy guard + verifier to Sepolia                |
| `pnpm dev`                                                    | Start Next.js front‑end                           |
| `pnpm lint`                                                   | Lint all TS/JS workspaces                         |

---

## 🛠 Tool‑chain versions

```text
Rust       : stable 1.79+
Risc Zero  : 0.19+
Node / pnpm: v20 / pnpm 9+
Foundry    : forge 0.2+
Solc       : 0.8.24
MetaMask   : ≥ 12.17 (7702 enabled)
```

---

## 🚀 Deployment guide (Sepolia)

1. `forge create ...` – deploy `Verifier.sol`
2. `forge create ...` – deploy `zkOtpGuard.sol` (pass verifier address)
3. Record the guard address in `.env` of `apps/frontend`.
4. Run the front‑end and execute the **“Secure with OTP”** wizard.

---

## 📜 License

All code is released under the MIT License unless stated otherwise. See individual submodules for their specific SPDX headers.

---

## 📋 TODO roadmap

### MVP (week 1)

* [ ] **Circuit** – finalize Rust guest; export verifier contract.
* [ ] **Contracts** – implement `execute(Call[] calldata, bytes receipt)` with proof verification & nonce checks.
* [ ] **Front‑end** – upgrade wizard (type‑4 Set‑Code tx) & OTP modal with WASM proof.
* [ ] **Deploy** – Sepolia deployment script + sample env.

---

Happy hacking! Feel free to open issues or PRs in their respective sub‑repos.
